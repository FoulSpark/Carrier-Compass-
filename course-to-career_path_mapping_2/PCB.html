<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCB Career Paths - Interactive Flowchart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .flowchart-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 30px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        .flowchart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
        }

        #flowchart {
            width: 100%;
            height: 800px;
        }

        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node circle {
            fill: #fff;
            stroke-width: 3px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
        }

        .node.root circle {
            fill: #667eea;
            stroke: #5a67d8;
        }

        .node.category circle {
            fill: #764ba2;
            stroke: #6b46c1;
        }

        .node.subcategory circle {
            fill: #f093fb;
            stroke: #ec4899;
        }

        .node:hover circle {
            transform: scale(1.1);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.2));
        }

        .node.root:hover circle {
            fill: #5a67d8;
        }

        .node.category:hover circle {
            fill: #6b46c1;
        }

        .node.subcategory:hover circle {
            fill: #ec4899;
        }

        .node.interested circle {
            fill: #48bb78 !important;
            stroke: #38a169 !important;
            animation: pulse 2s infinite;
        }

        .node.not-interested circle {
            fill: #e53e3e !important;
            stroke: #c53030 !important;
            opacity: 0.7;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(72, 187, 120, 0); }
            100% { box-shadow: 0 0 0 0 rgba(72, 187, 120, 0); }
        }

        .node text {
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: central;
            fill: white;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .node.root text {
            font-size: 14px;
            font-weight: 700;
        }

        .link {
            fill: none;
            stroke: #cbd5e0;
            stroke-width: 2;
            stroke-linecap: round;
            shape-rendering: crispEdges;
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke: #667eea;
            stroke-width: 3;
        }

        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 300px;
            z-index: 1000;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .tooltip.show {
            opacity: 1;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #667eea;
        }

        .modal h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .modal h3 {
            color: #764ba2;
            margin: 20px 0 10px 0;
            font-size: 1.3rem;
        }

        .modal ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .modal li {
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #4a5568;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #e2e8f0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            #flowchart {
                height: 600px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PCB Career Pathways</h1>
            <p>Explore your future in Physics, Chemistry & Biology</p>
        </div>

        <div class="flowchart-container">
            <div class="controls">
                <button class="btn" onclick="resetZoom()">Reset View</button>
                <button class="btn" onclick="expandAll()">Expand All</button>
                <button class="btn" onclick="collapseAll()">Collapse All</button>
                <button class="btn" onclick="clearPreferences()">Clear Preferences</button>
            </div>
            
            <div style="text-align: center; margin-bottom: 15px; color: #4a5568; font-size: 14px;">
                <strong>Controls:</strong> Click = View Details | Shift+Click = Mark Interested (Green) | Right-click = Not Interested (Red)
            </div>
            
            <svg id="flowchart"></svg>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #667eea;"></div>
                    <span>Main Stream</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #764ba2;"></div>
                    <span>Career Categories</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f093fb;"></div>
                    <span>Specific Careers</span>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        // Enhanced career data with detailed information
        const careerData = {
            "PCB Stream": {
                description: "Physics, Chemistry, and Biology - The foundation for medical and life sciences careers",
                details: "PCB is one of the most popular science streams, opening doors to prestigious medical and healthcare careers, research opportunities, and various allied science fields."
            },
            "Medical & Healthcare": {
                description: "Direct medical practice and patient care careers",
                details: "The most sought-after field for PCB students, offering opportunities to directly impact human health and well-being.",
                careers: {
                    "MBBS / BDS": {
                        description: "Bachelor of Medicine & Surgery / Bachelor of Dental Surgery",
                        details: "Duration: 5.5 years (MBBS) / 5 years (BDS)",
                        requirements: ["NEET qualification", "High academic performance", "Strong dedication"],
                        opportunities: ["Doctor", "Surgeon", "Specialist", "Researcher", "Medical Officer"]
                    },
                    "BAMS / BHMS": {
                        description: "Ayurvedic Medicine / Homeopathic Medicine",
                        details: "Duration: 5.5 years each",
                        requirements: ["NEET qualification", "Interest in traditional medicine"],
                        opportunities: ["Ayurvedic Doctor", "Homeopathic Practitioner", "Wellness Consultant", "Researcher"]
                    },
                    "Nursing / Paramedical": {
                        description: "Healthcare support and patient care",
                        details: "Duration: 3-4 years",
                        requirements: ["Class 12 PCB", "Compassionate nature", "Physical stamina"],
                        opportunities: ["Registered Nurse", "Medical Technician", "Healthcare Assistant", "Hospital Administrator"]
                    }
                }
            },
            "Allied Science & Research": {
                description: "Scientific research and laboratory-based careers",
                details: "Perfect for students interested in research, laboratory work, and advancing scientific knowledge.",
                careers: {
                    "B.Sc. Biology": {
                        description: "Bachelor of Science in Biological Sciences",
                        details: "Duration: 3 years",
                        requirements: ["Class 12 PCB", "Research aptitude", "Analytical thinking"],
                        opportunities: ["Research Scientist", "Lab Technician", "Quality Control Analyst", "Academic Researcher"]
                    },
                    "Biotechnology": {
                        description: "Application of biology in technology and industry",
                        details: "Duration: 4 years (B.Tech) / 3 years (B.Sc)",
                        requirements: ["Strong foundation in biology and chemistry", "Innovation mindset"],
                        opportunities: ["Biotechnologist", "Genetic Engineer", "Bioprocess Engineer", "Research Scientist"]
                    },
                    "Forensic Science": {
                        description: "Scientific investigation of crimes",
                        details: "Duration: 3-4 years",
                        requirements: ["Attention to detail", "Analytical skills", "Interest in criminal justice"],
                        opportunities: ["Forensic Scientist", "Crime Scene Investigator", "DNA Analyst", "Toxicologist"]
                    }
                }
            },
            "Agriculture & Environment": {
                description: "Sustainable farming and environmental conservation",
                details: "Growing field with focus on food security, sustainable practices, and environmental protection.",
                careers: {
                    "B.Sc. Agriculture": {
                        description: "Agricultural sciences and farming techniques",
                        details: "Duration: 4 years",
                        requirements: ["Interest in farming", "Environmental awareness", "Problem-solving skills"],
                        opportunities: ["Agricultural Officer", "Farm Manager", "Agricultural Consultant", "Research Scientist"]
                    },
                    "Forestry": {
                        description: "Forest management and conservation",
                        details: "Duration: 4 years",
                        requirements: ["Love for nature", "Physical fitness", "Conservation mindset"],
                        opportunities: ["Forest Officer", "Wildlife Conservationist", "Environmental Consultant", "Park Ranger"]
                    },
                    "Environmental Science": {
                        description: "Environmental protection and sustainability",
                        details: "Duration: 3-4 years",
                        requirements: ["Environmental awareness", "Research skills", "Policy understanding"],
                        opportunities: ["Environmental Scientist", "Pollution Control Officer", "Sustainability Consultant", "Climate Researcher"]
                    }
                }
            },
            "Professional Courses": {
                description: "Specialized professional degrees with direct career paths",
                details: "Professional courses that provide specialized skills and direct entry into specific career fields.",
                careers: {
                    "Pharmacy": {
                        description: "Pharmaceutical sciences and drug development",
                        details: "Duration: 4 years (B.Pharm) / 6 years (Pharm.D)",
                        requirements: ["Chemistry knowledge", "Attention to detail", "Patient interaction skills"],
                        opportunities: ["Pharmacist", "Drug Inspector", "Pharmaceutical Researcher", "Clinical Pharmacist"]
                    },
                    "Veterinary": {
                        description: "Animal healthcare and medicine",
                        details: "Duration: 5.5 years",
                        requirements: ["Love for animals", "NEET qualification", "Compassionate nature"],
                        opportunities: ["Veterinarian", "Animal Researcher", "Livestock Officer", "Pet Clinic Owner"]
                    },
                    "Biomedical Engg.": {
                        description: "Engineering applications in medical field",
                        details: "Duration: 4 years",
                        requirements: ["Engineering aptitude", "Medical interest", "Technical skills"],
                        opportunities: ["Biomedical Engineer", "Medical Device Designer", "Hospital Equipment Manager", "Research Engineer"]
                    }
                }
            },
            "Other Careers": {
                description: "Alternative career paths and competitive examinations",
                details: "Various other opportunities including competitive exams and alternative career paths.",
                careers: {
                    "NEET (Entrance)": {
                        description: "National Eligibility cum Entrance Test",
                        details: "Gateway to medical colleges",
                        requirements: ["Excellent preparation", "Strong foundation in PCB", "Dedication"],
                        opportunities: ["Medical College Admission", "Dental College Admission", "AYUSH Courses"]
                    },
                    "UPSC / Govt. Exams": {
                        description: "Civil services and government positions",
                        details: "Various government examinations",
                        requirements: ["General knowledge", "Current affairs", "Administrative skills"],
                        opportunities: ["IAS Officer", "IPS Officer", "Scientific Officer", "Government Researcher"]
                    },
                    "Teaching": {
                        description: "Education and academic careers",
                        details: "Teaching at various levels",
                        requirements: ["Subject expertise", "Communication skills", "Patience"],
                        opportunities: ["School Teacher", "College Professor", "Private Tutor", "Educational Consultant"]
                    }
                }
            }
        };

        // D3.js setup
        const width = 1200;
        const height = 800;
        const svg = d3.select("#flowchart")
            .attr("width", width)
            .attr("height", height);

        // Create zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.5, 3])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });

        svg.call(zoom);

        const g = svg.append("g");

        // Create hierarchy data
        const hierarchyData = {
            name: "PCB Stream",
            type: "root",
            children: [
                {
                    name: "Medical & Healthcare",
                    type: "category",
                    children: [
                        { name: "MBBS / BDS", type: "subcategory" },
                        { name: "BAMS / BHMS", type: "subcategory" },
                        { name: "Nursing / Paramedical", type: "subcategory" }
                    ]
                },
                {
                    name: "Allied Science & Research",
                    type: "category",
                    children: [
                        { name: "B.Sc. Biology", type: "subcategory" },
                        { name: "Biotechnology", type: "subcategory" },
                        { name: "Forensic Science", type: "subcategory" }
                    ]
                },
                {
                    name: "Agriculture & Environment",
                    type: "category",
                    children: [
                        { name: "B.Sc. Agriculture", type: "subcategory" },
                        { name: "Forestry", type: "subcategory" },
                        { name: "Environmental Science", type: "subcategory" }
                    ]
                },
                {
                    name: "Professional Courses",
                    type: "category",
                    children: [
                        { name: "Pharmacy", type: "subcategory" },
                        { name: "Veterinary", type: "subcategory" },
                        { name: "Biomedical Engg.", type: "subcategory" }
                    ]
                },
                {
                    name: "Other Careers",
                    type: "category",
                    children: [
                        { name: "NEET (Entrance)", type: "subcategory" },
                        { name: "UPSC / Govt. Exams", type: "subcategory" },
                        { name: "Teaching", type: "subcategory" }
                    ]
                }
            ]
        };

        // Create custom layout for straight vertical alignment
        const root = d3.hierarchy(hierarchyData);
        
        // Set fixed positions for each level
        const rootY = 80;
        const categoryY = 250;
        const subcategoryY = 420;
        
        // Position root node at center
        root.x = 0;
        root.y = rootY;
        
        // Get all leaf nodes (career options) and spread them out
        const leafNodes = root.descendants().filter(d => d.depth === 2);
        const minDistance = 120;
        const totalWidth = leafNodes.length * minDistance;
        const startX = -(totalWidth / 2) + (minDistance / 2);
        
        // Position all leaf nodes evenly
        leafNodes.forEach((d, index) => {
            d.x = startX + (index * minDistance);
            d.y = subcategoryY;
        });
        
        // Position category nodes evenly between root and leaves
        const categoryNodes = root.descendants().filter(d => d.depth === 1);
        const categorySpacing = totalWidth / categoryNodes.length;
        const categoryStartX = -(totalWidth / 2) + (categorySpacing / 2);
        
        categoryNodes.forEach((categoryNode, index) => {
            categoryNode.x = categoryStartX + (index * categorySpacing);
            categoryNode.y = categoryY;
        });

        // Create straight links instead of curved
        const links = g.selectAll(".link")
            .data(root.links())
            .enter().append("line")
            .attr("class", "link")
            .attr("x1", d => d.source.x + 100)
            .attr("y1", d => d.source.y + 100)
            .attr("x2", d => d.target.x + 100)
            .attr("y2", d => d.target.y + 100);

        // Create nodes
        const nodes = g.selectAll(".node")
            .data(root.descendants())
            .enter().append("g")
            .attr("class", d => `node ${d.data.type}`)
            .attr("transform", d => `translate(${d.x + 100},${d.y + 100})`)
            .on("mouseover", showTooltip)
            .on("mouseout", hideTooltip)
            .on("click", handleNodeClick)
            .on("contextmenu", handleRightClick);

        // Function to calculate text width
        function getTextWidth(text, fontSize) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = `${fontSize}px Segoe UI`;
            return context.measureText(text).width;
        }

        // Function to wrap text in circles
        function wrapText(text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = getTextWidth(currentLine + " " + word, 12);
                if (width < maxWidth * 0.7) { // Use 70% of available width for safety
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            
            // Limit to maximum 3 lines to prevent overflow
            if (lines.length > 3) {
                lines.splice(2, lines.length - 2);
                lines[2] = lines[2] + "...";
            }
            
            return lines;
        }

        // Add circles to nodes with fixed sizing
        nodes.append("circle")
            .attr("r", d => {
                if (d.data.type === "root") return 45;
                if (d.data.type === "category") return 40;
                return 35;
            });

        // Add text to nodes with proper wrapping
        nodes.each(function(d) {
            const node = d3.select(this);
            const circle = node.select("circle");
            const radius = parseFloat(circle.attr("r"));
            const maxWidth = (radius - 18) * 1.3; // Much more conservative padding and width
            const fontSize = d.data.type === "root" ? 11 : 9; // Much smaller font
            
            const lines = wrapText(d.data.name, maxWidth);
            const lineHeight = fontSize + 2;
            const totalHeight = lines.length * lineHeight;
            const startY = -(totalHeight / 2) + (lineHeight / 2);

            lines.forEach((line, i) => {
                node.append("text")
                    .attr("x", 0)
                    .attr("y", startY + (i * lineHeight))
                    .attr("text-anchor", "middle")
                    .attr("dominant-baseline", "middle")
                    .style("font-size", fontSize + "px")
                    .style("font-weight", "600")
                    .style("fill", "white")
                    .style("text-shadow", "1px 1px 2px rgba(0,0,0,0.3)")
                    .text(line);
            });
        });

        // Job preference tracking
        let jobPreferences = {};

        // Node interaction functions
        function handleNodeClick(event, d) {
            event.preventDefault();
            if (d.data.type === "subcategory") {
                // Check if shift key is pressed for preference marking
                if (event.shiftKey) {
                    toggleInterest(d, true);
                } else {
                    // Single click shows modal
                    showModal(event, d);
                }
            } else {
                // For root and category nodes, always show modal
                showModal(event, d);
            }
        }

        function handleRightClick(event, d) {
            event.preventDefault();
            if (d.data.type === "subcategory") {
                toggleInterest(d, false);
            }
        }

        function toggleInterest(d, isInterested) {
            const nodeName = d.data.name;
            
            // Find the correct node element by matching the data
            const nodeElement = nodes.filter(nodeData => nodeData.data.name === nodeName);
            
            if (jobPreferences[nodeName] === (isInterested ? 'interested' : 'not-interested')) {
                // Remove preference if clicking the same preference
                delete jobPreferences[nodeName];
                nodeElement.classed('interested', false).classed('not-interested', false);
            } else {
                // Set new preference
                jobPreferences[nodeName] = isInterested ? 'interested' : 'not-interested';
                nodeElement.classed('interested', isInterested).classed('not-interested', !isInterested);
            }
            
            updatePreferenceSummary();
        }

        function updatePreferenceSummary() {
            const interested = Object.keys(jobPreferences).filter(key => jobPreferences[key] === 'interested');
            const notInterested = Object.keys(jobPreferences).filter(key => jobPreferences[key] === 'not-interested');
            
            console.log('Interested in:', interested);
            console.log('Not interested in:', notInterested);
        }

        function clearPreferences() {
            jobPreferences = {};
            nodes.classed('interested', false).classed('not-interested', false);
            updatePreferenceSummary();
        }

        // Tooltip functions
        function showTooltip(event, d) {
            const tooltip = d3.select("#tooltip");
            const data = careerData[d.data.name];
            let tooltipContent = `<strong>${d.data.name}</strong><br>`;
            
            if (data) {
                tooltipContent += data.description;
            }
            
            if (d.data.type === "subcategory") {
                tooltipContent += `<br><br><em>Click: View details<br>Shift+Click: Mark as interested<br>Right-click: Mark as not interested</em>`;
            } else {
                tooltipContent += `<br><br><em>Click for more details</em>`;
            }
            
            tooltip.html(tooltipContent)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px")
                .classed("show", true);
        }

        function hideTooltip() {
            d3.select("#tooltip").classed("show", false);
        }

        // Modal functions
        function showModal(event, d) {
            const modal = document.getElementById("modal");
            const modalBody = document.getElementById("modal-body");
            const data = careerData[d.data.name];
            
            if (!data) return;

            let content = `<h2>${d.data.name}</h2>`;
            content += `<p><strong>Overview:</strong> ${data.description}</p>`;
            content += `<p>${data.details}</p>`;

            if (data.careers) {
                content += `<h3>Career Options:</h3>`;
                for (const [career, info] of Object.entries(data.careers)) {
                    content += `
                        <div style="margin-bottom: 20px; padding: 15px; background: #f7fafc; border-radius: 8px;">
                            <h4 style="color: #667eea; margin-bottom: 8px;">${career}</h4>
                            <p><strong>Description:</strong> ${info.description}</p>
                            <p><strong>Details:</strong> ${info.details}</p>
                            <p><strong>Requirements:</strong></p>
                            <ul>
                                ${info.requirements.map(req => `<li>${req}</li>`).join('')}
                            </ul>
                            <p><strong>Career Opportunities:</strong></p>
                            <ul>
                                ${info.opportunities.map(opp => `<li>${opp}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
            }

            modalBody.innerHTML = content;
            modal.style.display = "block";
        }

        function closeModal() {
            document.getElementById("modal").style.display = "none";
        }

        // Control functions
        function resetZoom() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
        }

        function expandAll() {
            nodes.selectAll("circle")
                .transition()
                .duration(500)
                .attr("r", d => {
                    if (d.data.type === "root") return 45;
                    if (d.data.type === "category") return 40;
                    return 35;
                });
        }

        function collapseAll() {
            nodes.selectAll("circle")
                .transition()
                .duration(500)
                .attr("r", d => {
                    if (d.data.type === "root") return 40;
                    if (d.data.type === "category") return 35;
                    return 30;
                });
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById("modal");
            if (event.target === modal) {
                closeModal();
            }
        }

        // Add entrance animations
        nodes.style("opacity", 0)
            .transition()
            .duration(1000)
            .delay((d, i) => i * 100)
            .style("opacity", 1);

        links.style("opacity", 0)
            .transition()
            .duration(1000)
            .delay(500)
            .style("opacity", 1);
    </script>
</body>
</html>
